!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e=function(){return e=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++)for(var i in t=arguments[n])({}).hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},e.apply(this,arguments)},t=function(e){return["undefined","null"].includes(v(e))},n=function(e){return"string"===v(e)},r=function(e){return"number"===v(e)},i=function(e){return"object"===v(e)&&!t(e)},o=function(e){return"regexp"===v(e)},a=function(e){return Array.isArray(e)&&"array"===v(e)},u=function(e){return t(e)?"":"".concat(e)},c={}.hasOwnProperty,s=function(e){return i(e)?Object.keys(e):[]},d=function(e,t){var n=s(e);return!(!i(e)||!i(t)||n.length!==s(t).length||n.map((function(n,r){return i(e[n])?d(e[n],t[n]):e[n]===t[n]})).includes(!1))},f=function(e,t){if(!i(e))return!1;try{if("string"===v(t))return delete e[t];if("array"===v(t))return t.map((function(t){return delete e[t]}));"object"===v(t)&&t.constructor===RegExp&&s(e).forEach((function(n){t.test(n)&&f(e,n)}))}catch(e){return!1}},l=function(e){return a(e)?0===e.length:i(e)?0===s(e).length:!e},v=function(e){return{}.toString.call(e).slice(8,-1).toLowerCase()},g=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},m=function(e){var t=this;this.growingIO=e,this.listenerSet=!1,this.setListeners=function(){t.listenerSet||(window.addEventListener("unhandledrejection",t.handleError,!0),window.addEventListener("error",t.handleError,!0)),t.listenerSet=!0},this.handleError=function(e){e.reason?t.errorParse(e.reason.stack,e.reason.message,e.eventTime):e.error?t.errorParse(e.error.stack,e.error.message,e.eventTime):e.target&&t.buildErrorEvent({error_title:"Resource loading error",error_content:"at ".concat(e.target.href||e.target.src||e.target.currentSrc)},e.eventTime)},this.errorParse=function(e,r,i){var o,a,u,c,s=n(e)&&e.length?e.split("\n"):[],d={error_title:r||s[0],error_content:(c=window.navigator.userAgent,/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(c)&&!/chrome\/(\d+\.\d+)/i.test(c)?(null!==(o=s[0])&&void 0!==o?o:"").trim()||(null!==(a=s[1])&&void 0!==a?a:"").trim():(null!==(u=s[1])&&void 0!==u?u:"").trim())};t.buildErrorEvent(d,i)},this.destroy=function(){window.removeEventListener("unhandledrejection",t.handleError),window.removeEventListener("error",t.handleError)},this.buildErrorEvent=function(e,n){var r;null===(r=t.growingIO.plugins.gioPerformance)||void 0===r||r.buildPerfEvent("Error",e,n)},this.setListeners(),window.gdp.ef&&(window.removeEventListener("unhandledrejection",window.gdp.ef),window.removeEventListener("error",window.gdp.ef),window.gdp.ef=void 0),!l(window.gdp.e)&&a(window.gdp.e)&&(window.gdp.e.forEach(this.handleError),window.gdp.e=void 0)},p=-1,h=function(e){addEventListener("pageshow",(function(t){t.persisted&&(p=t.timeStamp,e(t))}),!0)},w=function(){return window.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]},E=function(){var e=w();return e&&e.activationStart||0},x=function(e,t){var n=w(),r="navigate";return 0>p?n&&(r=document.prerendering||E()>0?"prerender":n.type.replace(/_/g,"-")):r="back-forward-cache",{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:"v3-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},_=function(e,t,n){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(e){t(e.getEntries())}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},y=function(e,t){var n=function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(e(r),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},T=function(e,t,n,r){var i,o;return function(a){t.value>=0&&(a||r)&&((o=t.value-(i||0))||void 0===i)&&(i=t.value,t.delta=o,t.rating=function(e,t){return e>t[1]?"poor":e>t[0]?"needs-improvement":"good"}(t.value,n),e(t))}},b=-1,P=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},L=function(){y((function(e){var t=e.timeStamp;b=t}),!0)},O=function(){return 0>b&&(b=P(),L(),h((function(){setTimeout((function(){b=P(),L()}),0)}))),{get firstHiddenTime(){return b}}},R={},C=function e(t){document.prerendering?addEventListener("prerenderingchange",(function(){return e(t)}),!0):"complete"!==document.readyState?addEventListener("load",(function(){return e(t)}),!0):setTimeout(t,0)},I=function(e,t){t=t||{};var n=[800,1800],r=x("TTFB"),i=T(e,r,n,t.reportAllChanges);C((function(){var o=w();if(o){if(r.value=Math.max(o.responseStart-E(),0),0>r.value||r.value>performance.now())return;r.entries=[o],i(!0),h((function(){r=x("TTFB",0),(i=T(e,r,n,t.reportAllChanges))(!0)}))}}))},N={FCP:"first_contentful_paint",LCP:"largest_contentful_paint",TTFB:"time_to_first_byte"},k=function(e,t){void 0===t&&(t={});var i=this;this.growingIO=e,this.options=t,this.performance={},this.setPerformanceData=function(e){i.vitalsData[e.name].push(e)},this.getLaunchTime=function(){var e=window.performance.timing;return e.loadEventEnd-e.navigationStart},this.getInteractiveTime=function(){var e=window.performance.timing;return e.domContentLoadedEventEnd-e.navigationStart},this.generatePerfData=function(){window.setTimeout((function(){var e={page_launch_time:i.getLaunchTime(),interactive_time:i.getInteractiveTime()};!function(t,i){s(t).forEach((function(i){return function(t,i){l(t)||(e[N[i]]=function(e,t){return r(e)?Number(e.toFixed(r(t)?t:2)):n(e)&&"NaN"!==u(Number(e))?Number(Number(e).toFixed(r(t)?t:2)):e}(function(e){try{var t=Array.from(e);return t[t.length-1]}catch(e){return}}(t).value,0))}(t[i],i)}))}(i.vitalsData),d(e,i.performance)||(i.buildMonitorEvent(e),i.performance=e)}),1e3)},this.destroy=function(){window.removeEventListener("load",i.generatePerfData)},this.buildMonitorEvent=function(e){var t;null===(t=i.growingIO.plugins.gioPerformance)||void 0===t||t.buildPerfEvent("WebLaunchTime",e)},this.vitalsData={FCP:[],FID:[],INP:[],LCP:[],TTFB:[]},function(e,t){t=t||{};var n,r=[1800,3e3],i=O(),o=x("FCP"),a=function(e){e.forEach((function(e){"first-contentful-paint"===e.name&&(c&&c.disconnect(),e.startTime<i.firstHiddenTime&&(o.value=Math.max(e.startTime-E(),0),o.entries.push(e),n(!0)))}))},u=window.performance&&window.performance.getEntriesByName&&window.performance.getEntriesByName("first-contentful-paint")[0],c=u?null:_("paint",a);(u||c)&&(n=T(e,o,r,t.reportAllChanges),u&&a([u]),h((function(i){o=x("FCP"),n=T(e,o,r,t.reportAllChanges),requestAnimationFrame((function(){requestAnimationFrame((function(){o.value=performance.now()-i.timeStamp,n(!0)}))}))})))}(this.setPerformanceData),function(e,t){t=t||{};var n,r=[2500,4e3],i=O(),o=x("LCP"),a=function(e){var t=e[e.length-1];if(t){var r=Math.max(t.startTime-E(),0);r<i.firstHiddenTime&&(o.value=r,o.entries=[t],n())}},u=_("largest-contentful-paint",a);if(u){n=T(e,o,r,t.reportAllChanges);var c=function(){R[o.id]||(a(u.takeRecords()),u.disconnect(),R[o.id]=!0,n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,c,{once:!0,capture:!0})})),y(c,!0),h((function(i){o=x("LCP"),n=T(e,o,r,t.reportAllChanges),requestAnimationFrame((function(){requestAnimationFrame((function(){o.value=performance.now()-i.timeStamp,R[o.id]=!0,n(!0)}))}))}))}}(this.setPerformanceData,{reportAllChanges:!0}),I(this.setPerformanceData),window.addEventListener("load",this.generatePerfData)};function S(e,n,r,i){if(void 0===i&&(i=!1),!t(e)&&(function(e,n){return!t(e)&&c.call(e,n)}(e,n)||i)){var o=r(e[n]);"function"==typeof o&&(e[n]=o)}}var H,F=function(t,r){var c=this;this.growingIO=t,this.options=r,this.initOptions=function(){var e;i(c.options.network)&&(null===(e=c.options.network)||void 0===e?void 0:e.exclude)&&(c.excludeRegExp=c.options.network.exclude)},this.verifyUrl=function(e){if(e.indexOf(c.growingIO.uploader.requestURL)>-1)return!0;if(a(c.excludeRegExp)){var t=function(e){if(a(e)){for(var t=0,n=[],r=0,i=e;r<i.length;r++){var o=i[r];o&&!l(o)&&(n[t++]=o)}return n}return e}(c.excludeRegExp.map((function(t){return o(t)?t.test(e):n(t)?e.indexOf(t)>-1:void 0})));return!l(t)}return n(c.excludeRegExp)?e.indexOf(c.excludeRegExp)>-1:!!o(c.excludeRegExp)&&c.excludeRegExp.test(e)},this.getTimestamp=function(){return window.performance?window.performance.now():Date.now()},this.hookXHR=function(){var t=c;c.originXHR=window.XMLHttpRequest;var n=XMLHttpRequest.prototype,r={};S(n,"open",(function(e){return function(){for(var n=[],i=0;arguments.length>i;i++)n[i]=arguments[i];this.gio_XHR_id=g(),t.verifyUrl(n[1])||(r[this.gio_XHR_id]={type:"XHR",method:n[0],url:n[1]}),e.apply(this,n)}})),S(n,"send",(function(n){return function(){for(var i=this,o=[],a=0;arguments.length>a;a++)o[a]=arguments[a];this.addEventListener("loadend",(function(n){r[i.gio_XHR_id]&&(r[i.gio_XHR_id]=e(e({},r[i.gio_XHR_id]),{duration:(n.timeStamp||t.getTimestamp())-r[i.gio_XHR_id].start,status:i.status}),t.buildNetworkEvent(r[i.gio_XHR_id]),f(r,i.gio_XHR_id))})),this.addEventListener("error",(function(){t.buildErrorEvent({error_title:"XMLHttpRequest Error",error_content:i.status})})),r[this.gio_XHR_id]&&(r[this.gio_XHR_id].start=t.getTimestamp()),n.apply(this,o)}}))},this.hookFetch=function(){var t=c;c.originFetch=window.fetch,S(window,"fetch",(function(n){return function(r,i){var o;return void 0===i&&(i={}),t.verifyUrl(r)||(o={type:"Fetch",method:i.method||"GET",url:r,start:t.getTimestamp()}),n.call(window,r,i).then((function(n){o=e(e({},o),{duration:t.getTimestamp()-o.start,status:n.status}),t.buildNetworkEvent(o)}),(function(e){var n=e.stack.split("\n");t.buildErrorEvent({error_title:n[0]||u(e)||"Fetch Request Error",error_content:o.url})}))}}))},this.buildErrorEvent=function(t){if(c.options.exception){var n=c.growingIO.dataStore,r=n.eventContextBuilder,i=n.eventConverter,o=n.currentPage;i(e({eventType:"CUSTOM",pageShowTimestamp:o.time,eventName:"Error",attributes:t},r()))}},this.destroy=function(){window.XMLHttpRequest=c.originXHR,window.fetch=c.originFetch},this.buildNetworkEvent=function(e){var t;if(!1!==r.network){var n=e.duration,i=e.url,o=e.method,a=e.status;null===(t=c.growingIO.plugins.gioPerformance)||void 0===t||t.buildPerfEvent("NetworkRequest",{response_time:n,request_address:i,request_method:o,http_code:a})}},this.initOptions(),this.hookXHR(),this.hookFetch(),window.performance||("warn",console.log("%c[GrowingIO]：当前浏览器无法支持性能相关API，网络监测数据可能存在偏差!","color: #F59E0B"))},A={install:function(e){if(e&&e.config){var t=function(t,n,r){X.call(this,t,n,r,e)};if(function(e){return"function"===v(e)}(e.config.errorHandler)){var n=e.config.errorHandler;e.config.errorHandler=function(){var e=n.apply(this,arguments);return t(arguments[0],arguments[1],arguments[2]),e}}else e.config.errorHandler=t}}},X=function(t,n,r,i){var o={message:"".concat(t.message,"(").concat(r,")"),name:t.name,stack:t.stack||[]};if(null==i?void 0:i.version){var a=Number.parseInt(function(e){try{return Array.from(e)[0]}catch(e){return}}(function(e,t){return"string"==typeof e?e.split("."):e}(null==i?void 0:i.version)),10);switch(a){case 2:o=e(e({},o),D(n));break;case 3:o=e(e({},o),M(n));break;default:return}}o=e(e({},o),q(o.stack)),(window.gdp||window.gio||function(){})("track","Error",{error_title:"".concat(o.name,": ").concat(o.message),error_content:"at ".concat(o.functionName," (").concat(o.componentName,")")})},D=function(e){var t="";if(e.$root===e)t="root";else{var n=e._isVue?e.$options&&e.$options.name||e.$options&&e.$options._componentTag:e.name;t=(n?"component <"+n+">":"anonymous component")+(e._isVue&&e.$options&&e.$options.__file?" at "+(e.$options&&e.$options.__file):"")}return{componentName:t}},M=function(e){var t="";if(e.$root===e)t="root";else{var n=e.$options&&e.$options.name;t=n?"component <"+n+">":"anonymous component"}return{componentName:t}},q=function(e){var t,n=e.split("\n");return n.find((function(e,n){var r=e.match(/at (.*?) \((.*):(\d{1,}):(\d{1,})\)/);if(a(r)&&!t)return t=r[1],r.length>0})),{title:n[0],functionName:t}};window.gioPerformance={name:"gioPerformance",method:function(t){var n,r=this;this.growingIO=t,this.inited=!1,this.cacheQueue=[],this.init=function(){if(!r.inited){var e=r.growingIO.vdsConfig,t=e.performance,n=e.dataCollect;t.monitor&&(r.monitor=new k(r.growingIO)),t.exception&&(r.exception=new m(r.growingIO)),r.network=new F(r.growingIO,t),n&&r.sendCacheQuene(),r.inited=!0}},this.sendCacheQuene=function(){H.isEmpty(r.cacheQueue)||(r.cacheQueue.forEach((function(e){r.buildPerfEvent(e.eventName,e.attributes,e.eventTime)})),r.cacheQueue=[])},this.buildPerfEvent=function(t,n,i){var o=r.growingIO,a=o.dataStore,u=a.eventContextBuilder,c=a.eventConverter,s=a.currentPage,d=o.vdsConfig;if(o.gioSDKInitialized&&d.dataCollect){H.forEach(n,(function(e,t){(Number.isNaN(e)||H.isNil(e))&&(n[t]=0),n[t]=H.fixed(e,0)}));var f=e({eventType:"CUSTOM",pageShowTimestamp:s.time,eventName:t,attributes:n},u());i&&(f.timestamp=i),c(f)}else r.cacheQueue.push({eventName:t,attributes:n,eventTime:i||+Date.now()})},H=this.growingIO.utils,this.growingIO.gioSDKInitialized?this.init():this.growingIO.emitter.on("SDK_INITIALIZED",(function(){r.init()})),null===(n=this.growingIO.emitter)||void 0===n||n.on("OPTION_CHANGE",(function(e){var t=e.optionName,n=e.optionValue;"dataCollect"===t&&!0===n&&r.sendCacheQuene()}))},GioVue:A,gioReactErrorReport:function(e,t){var n=e.stack.split("\n")[0],i=t.componentStack.split("\n"),o=[];i.forEach((function(e){var t="".concat(e," ").match(/at (.*?) /);a(t)&&t[1]&&o.push(t[1])}));var u="at ".concat(function(e,t){return void 0===t&&(t=1),a(e)&&r(t)?e.slice(t>0?t:1,e.length):e}(o.reverse()).join("/"));(window.gdp||window.gio||function(){})("track","Error",{error_title:n,error_content:u})}}}));
